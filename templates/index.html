<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<link rel="manifest" href="/manifest.json?v=final">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#0f1020">
<link rel="apple-touch-icon" href="https://raw.githubusercontent.com/izumi02-ui/izumi-downloader/refs/heads/main/file_0000000086cc7206b52bd98a7f95f826.png">

<title>Nexus ‚Äî Advanced Media Saving System</title>
<meta name="description" content="NEXUS'S System: High-speed Instagram media fetching with I engine.">

<meta property="og:title" content="NEXUS : MEDIA SAVING SYSTEM">
<meta property="og:description" content="Download high-quality Instagram media instantly via Nexus's Engine.">
<meta property="og:image" content="https://raw.githubusercontent.com/izumi02-ui/izumi-downloader/refs/heads/main/New%20Project%206%20%5B43F93B0%5D.png">
<meta property="og:type" content="website">

<style>
/* üèéÔ∏è PERFORMANCE LAYER (SAME) */
* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

body {
  margin: 0; min-height: 100vh;
  display: flex; align-items: center; justify-content: center;
  background: radial-gradient(circle at top, #0f1020, #05050a) no-repeat center center fixed;
  background-size: cover;
  font-family: 'Poppins', system-ui, sans-serif;
  color: white; overflow: hidden;
  position: fixed; width: 100%; height: 100%;
}

#overlay {
  position: fixed; top: 0; left: 0; width: 100%; height: 100%;
  background: rgba(0,0,0,0.4); z-index: 999;
  display: none; opacity: 0; transition: opacity 0.3s ease;
}

.menu-btn {
  position: absolute; top: 25px; right: 25px;
  cursor: pointer; z-index: 1001; padding: 10px;
}
.menu-btn div { width: 22px; height: 2px; background: white; margin: 5px 0; border-radius: 2px; }

.sidebar {
  position: fixed; top: 0; right: 0;
  width: 280px; height: 100%;
  background: rgba(10, 10, 25, 0.95); backdrop-filter: blur(25px); -webkit-backdrop-filter: blur(25px);
  z-index: 1000; transform: translate3d(100%, 0, 0);
  transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1);
  padding: 80px 20px 20px; border-left: 1px solid rgba(255,255,255,0.05);
}
.sidebar.active { transform: translate3d(0, 0, 0); }
.sidebar h2 { font-size: 16px; letter-spacing: 2px; color: #8f7bff; margin-bottom: 20px; text-transform: uppercase; }

.history-list { list-style: none; padding: 0; max-height: 70vh; overflow-y: auto; }

/* üé¨ History Item & Menu Updates */
.history-item {
  background: rgba(255,255,255,0.05); padding: 12px;
  border-radius: 12px; margin-bottom: 10px;
  display: flex; flex-direction: column; gap: 8px;
  border: 1px solid rgba(255,255,255,0.08);
  position: relative;
}
.history-cap { font-size: 11px; font-weight: 600; color: #8f7bff; width: 85%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.history-meta { display: flex; justify-content: space-between; align-items: center; font-size: 10px; }
.history-meta a { color: #fff; text-decoration: none; border: 1px solid #8f7bff; padding: 3px 8px; border-radius: 6px; }

/* üîò Three Dots Style */
.options-btn {
  position: absolute; top: 12px; right: 12px;
  color: #fff; opacity: 0.6; cursor: pointer; font-size: 16px;
  padding: 0 5px;
}

/* üçø Dropdown Animation */
.delete-dropdown {
  position: absolute; top: 32px; right: 10px;
  background: #8f7bff; color: white; border-radius: 8px;
  padding: 5px 12px; font-size: 10px; font-weight: bold;
  box-shadow: 0 4px 15px rgba(0,0,0,0.3);
  z-index: 10; display: none; opacity: 0;
  transform: translateY(-10px);
  transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}
.delete-dropdown.show { display: block; opacity: 1; transform: translateY(0); }

/* ‚ú® Clear All Color Update */
.clear-all { font-size: 10px; color: #fff; background: rgba(143, 123, 255, 0.3); padding: 4px 10px; border-radius: 6px; border: 1px solid #8f7bff; cursor: pointer; transition: 0.3s; }
.clear-all:hover { background: #8f7bff; }

#splash {
  position: fixed; top: 0; left: 0; width: 100%; height: 100%;
  background: #05050a; display: flex; flex-direction: column;
  align-items: center; justify-content: center; z-index: 9999;
}
.splash-logo { font-size: 42px; font-weight: 800; letter-spacing: 5px; background: linear-gradient(135deg, #fff, #8f7bff); -webkit-background-clip: text; -webkit-text-fill-color: transparent; animation: pulse 1.5s infinite alternate; }

@keyframes pulse { from { transform: scale(1); opacity: 0.7; } to { transform: scale(1.08); opacity: 1; } }

.card {
  width: 92%; max-width: 420px;
  background: rgba(20,20,40,0.55); backdrop-filter: blur(25px);
  border-radius: 24px; padding: 30px; border: 1px solid rgba(255,255,255,0.1); text-align: center;
}

.logo { font-size: 38px; font-weight: 800; letter-spacing: 3px; text-transform: uppercase; }
.logo span { color: #8f7bff; }
.subtitle { font-size: 10px; opacity: .5; margin-bottom: 30px; text-transform: uppercase; }

input {
  width: 100%; padding: 18px; border-radius: 15px; border: 1px solid rgba(255,255,255,0.1);
  outline: none; background: rgba(0,0,0,.4); color: white; margin-bottom: 15px;
}
input:focus { border-color: #8f7bff; }

button {
  width: 100%; padding: 15px; border-radius: 15px; border: none;
  font-weight: 700; font-size: 15px; color: white;
  background: linear-gradient(135deg, #7b5cff, #9b6dff);
  box-shadow: 0 10px 20px rgba(123,92,255,0.3);
}

.status { margin-top: 20px; display: flex; flex-direction: column; align-items: center; gap: 12px; }
.hidden { display: none; }
.loader { width: 32px; height: 32px; border-radius: 50%; border: 3px solid rgba(255,255,255,.05); border-top: 3px solid #8f7bff; animation: spin .9s linear infinite; }
@keyframes spin { to { transform: rotate(360deg); } }

#result a {
  display: inline-block; margin-top: 20px; color: #fff; text-decoration: none; font-weight: 600;
  padding: 14px 28px; background: rgba(143, 123, 255, 0.2); border: 1px solid #8f7bff; border-radius: 14px;
}
.footer { margin-top: 30px; font-size: 9px; opacity: .4; letter-spacing: 1.5px; text-transform: uppercase; }
</style>
</head>
<body>

<div id="overlay" onclick="toggleSidebar()"></div>

<div id="splash">
  <div class="splash-logo">IZUMI</div>
  <p style="font-size: 8px; opacity: 0.4; letter-spacing: 3px; margin-top: 20px;">NEXUS SYSTEM INITIALIZING...</p>
</div>

<div class="menu-btn" onclick="toggleSidebar()">
  <div></div><div></div><div></div>
</div>

<div class="sidebar" id="sidebar">
  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
    <h2 style="margin:0;">Nexus History</h2>
    <span onclick="clearAllHistory()" class="clear-all">CLEAR ALL</span>
  </div>
  <ul id="historyList" class="history-list"></ul>
  <div style="margin-top: 30px; opacity: 0.2; font-size: 9px; letter-spacing: 1px;">CORE ENGINE : IZUMI</div>
</div>

<div class="card">
  <div class="logo">IZUMI<span>.</span></div>
  <div class="subtitle">Nexus Advanced Media Saving System</div>

  <input id="linkInput" placeholder="Paste Instagram URL here..." autocomplete="off">
  <button onclick="startDownload()">FETCH MEDIA</button>

  <div id="statusBox" class="status hidden">
    <div class="loader"></div>
    <p id="statusText" style="font-size: 12px; opacity: 0.9;">Connecting to engine...</p>
  </div>
  <div id="result"></div>
  <div class="footer">SYSTEM : NEXUS ‚Ä¢ CORE : IZUMI ‚Ä¢ DESIGNED BY : ROHIT</div>
</div>

<script>
window.addEventListener('load', () => {
  setTimeout(() => {
    const splash = document.getElementById('splash');
    splash.style.opacity = '0';
    setTimeout(() => { splash.style.display = 'none'; }, 800);
  }, 2000);
  renderHistory();
});

function toggleSidebar() {
  const sidebar = document.getElementById('sidebar');
  const overlay = document.getElementById('overlay');
  sidebar.classList.toggle('active');
  if(sidebar.classList.contains('active')) {
    overlay.style.display = 'block';
    setTimeout(() => overlay.style.opacity = '1', 10);
  } else {
    overlay.style.opacity = '0';
    setTimeout(() => overlay.style.display = 'none', 300);
    closeAllMenus(); // Sidebar band hone par menus bhi band
  }
}

function saveToHistory(downloadUrl, caption) {
  let history = JSON.parse(localStorage.getItem('nexus_history') || '[]');
  if (history.some(item => item.url === downloadUrl)) return;

  const newEntry = {
    url: downloadUrl,
    caption: caption || "Instagram Media",
    time: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })
  };
  
  history.unshift(newEntry);
  if (history.length > 20) history.pop();
  localStorage.setItem('nexus_history', JSON.stringify(history));
  renderHistory();
}

// üçî Three Dots Menu Handler
function toggleMenu(e, index) {
  e.stopPropagation();
  closeAllMenus();
  const menu = document.getElementById(`menu-${index}`);
  menu.classList.toggle('show');
}

function closeAllMenus() {
  document.querySelectorAll('.delete-dropdown').forEach(m => m.classList.remove('show'));
}

// Bahar click karne par menu band
document.addEventListener('click', closeAllMenus);

function deleteHistoryItem(index) {
  let history = JSON.parse(localStorage.getItem('nexus_history') || '[]');
  history.splice(index, 1);
  localStorage.setItem('nexus_history', JSON.stringify(history));
  renderHistory();
}

function clearAllHistory() {
  if(confirm("Clear all history?")) {
    localStorage.removeItem('nexus_history');
    renderHistory();
  }
}

function renderHistory() {
  const historyList = document.getElementById('historyList');
  const history = JSON.parse(localStorage.getItem('nexus_history') || '[]');
  
  if (history.length === 0) {
    historyList.innerHTML = '<li style="opacity:0.4; font-size:12px; margin-top:15px;">No recent saves.</li>';
    return;
  }

  historyList.innerHTML = history.map((item, index) => `
    <li class="history-item">
      <div class="history-cap">${item.caption}</div>
      <div class="options-btn" onclick="toggleMenu(event, ${index})">‚ãÆ</div>
      <div class="delete-dropdown" id="menu-${index}" onclick="deleteHistoryItem(${index})">DELETE</div>
      <div class="history-meta">
        <span>üïí ${item.time}</span>
        <a href="${item.url}" target="_blank">RE-DOWNLOAD</a>
      </div>
    </li>
  `).join('');
}

const statusBox = document.getElementById("statusBox");
const statusText = document.getElementById("statusText");
const resultBox = document.getElementById("result");

function showStatus(text) {
  statusBox.classList.remove("hidden");
  statusText.innerText = text;
}

async function startDownload() {
  const link = document.getElementById("linkInput").value.trim();
  resultBox.innerHTML = "";
  if (!link) { showStatus("üö´ Error: Please enter a valid URL."); return; }
  
  showStatus(" Izumi is fetching data...");

  try {
    const res = await fetch("/api/download", {
      method: "POST",
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify({ url: link })
    });
    const data = await res.json();
    
    if (data.status === "success") {
      showStatus(" Success: Media engine ready.");
      resultBox.innerHTML = `<a href="${data.link}" download>DOWNLOAD NOW</a>`;
      saveToHistory(data.link, data.caption);
    } else {
      showStatus("‚ö†Ô∏è " + data.message);
    }
  } catch (e) {
    showStatus("üöÄ Connection Error. Please try again.");
  }
}
</script>
</body>
</html>
